<div id="<%= dom_id(comment) %>" class="comment bg-white dark:bg-gray-800 rounded-lg p-4 mb-4 <%= 'ml-8' if comment.parent_id.present? %>">
  <div class="flex items-start space-x-3">
    <div class="flex-shrink-0">
      <div class="h-8 w-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center">
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
          <%= comment.user.first_name&.first&.upcase || 'U' %>
        </span>
      </div>
    </div>
    
    <div class="flex-1 min-w-0">
      <div class="flex items-center space-x-2 mb-2">
        <p class="text-sm font-medium text-gray-900 dark:text-white">
          <%= comment.user.first_name %> <%= comment.user.last_name %>
        </p>
        <span class="text-xs text-gray-500 dark:text-gray-400">
          <%= time_ago_in_words(comment.created_at) %> ago
        </span>
        <% if comment.updated_at > comment.created_at + 1.minute %>
          <span class="text-xs text-gray-400 dark:text-gray-500">(edited)</span>
        <% end %>
      </div>
      
      <div class="comment-body text-sm text-gray-700 dark:text-gray-300 mb-3">
        <%= simple_format(comment.body) %>
      </div>
      
      <div class="flex items-center space-x-4">
        <% if user_signed_in? %>
          <button class="reply-btn text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium" 
                  data-comment-id="<%= comment.id %>">
            Reply
          </button>
        <% end %>
        
        <% if policy(comment).update? %>
          <button class="edit-btn text-xs text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 font-medium"
                  data-comment-id="<%= comment.id %>">
            Edit
          </button>
        <% end %>
        
        <% if policy(comment).destroy? %>
          <%= link_to "Delete", 
              blog_comment_path(comment.blog, comment), 
              method: :delete,
              data: { 
                confirm: "Are you sure?",
                turbo_method: :delete
              },
              class: "text-xs text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 font-medium" %>
        <% end %>
      </div>
      
      <!-- Reply Form (hidden by default) -->
      <div id="reply-form-<%= comment.id %>" class="reply-form mt-4 hidden">
        <%= form_with model: [comment.blog, comment.blog.comments.build], 
            data: { turbo: true },
            class: "space-y-3" do |form| %>
          <%= form.hidden_field :parent_id, value: comment.id %>
          <%= form.text_area :body, 
              placeholder: "Write a reply...",
              class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm",
              rows: 3 %>
          <div class="flex justify-end space-x-2">
            <button type="button" 
                    class="cancel-reply px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300">
              Cancel
            </button>
            <%= form.submit "Reply", 
                class: "px-4 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800" %>
          </div>
        <% end %>
      </div>
      
      <!-- Edit Form (hidden by default) -->
      <% if policy(comment).update? %>
        <div id="edit-form-<%= comment.id %>" class="edit-form mt-4 hidden">
          <%= form_with model: [comment.blog, comment], 
              data: { turbo: true },
              class: "space-y-3" do |form| %>
            <%= form.text_area :body, 
                class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm",
                rows: 3 %>
            <div class="flex justify-end space-x-2">
              <button type="button" 
                      class="cancel-edit px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300">
                Cancel
              </button>
              <%= form.submit "Update", 
                  class: "px-4 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800" %>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <!-- Nested Replies -->
      <% if comment.replies.any? %>
        <div class="replies mt-4">
          <% comment.replies.each do |reply| %>
            <%= render 'comments/comment', comment: reply %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>